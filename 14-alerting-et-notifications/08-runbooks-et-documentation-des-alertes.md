üîù Retour au [Sommaire](/SOMMAIRE.md)

# 14.8 Runbooks et Documentation des Alertes

## Introduction

Un **runbook** (aussi appel√© playbook ou proc√©dure op√©rationnelle) est un document qui explique **comment r√©pondre √† une alerte sp√©cifique**. C'est votre guide de d√©pannage pas √† pas, votre mode d'emploi en cas de probl√®me.

Imaginez que vous √™tes d'astreinte √† 3h du matin. Votre t√©l√©phone sonne : alerte critique. Vous √™tes encore √† moiti√© endormi. Un bon runbook est ce qui vous permet de r√©soudre le probl√®me efficacement, m√™me dans cet √©tat.

**Sans runbook** :
```
üö® Alerte : HighPodMemoryUsage
ü§î Qu'est-ce que √ßa veut dire ?
ü§î Qu'est-ce que je dois faire ?
ü§î Est-ce urgent ?
üò∞ Panique...
```

**Avec runbook** :
```
üö® Alerte : HighPodMemoryUsage
üìñ Ouvre le runbook
‚úÖ √âtape 1 : V√©rifier l'utilisation actuelle ‚Üí OK
‚úÖ √âtape 2 : Examiner les logs ‚Üí Fuite m√©moire d√©tect√©e
‚úÖ √âtape 3 : Red√©marrer le pod ‚Üí Probl√®me r√©solu
üòå Retour au lit
```

Dans cette section, nous allons explorer comment cr√©er, organiser et maintenir des runbooks efficaces pour votre syst√®me d'alerting.

## Pourquoi les Runbooks sont Essentiels

### 1. R√©duction du Stress

**Sans runbook** : Chaque alerte est une source de stress et d'incertitude

**Avec runbook** : Processus clair, pas de panique, confiance

### 2. Temps de R√©solution

**Sans runbook** : 30-60 minutes pour investiguer et trouver la solution

**Avec runbook** : 5-15 minutes en suivant les √©tapes

### 3. Coh√©rence

**Sans runbook** : Chaque personne r√©sout √† sa mani√®re, r√©sultats variables

**Avec runbook** : M√™me processus pour tous, qualit√© constante

### 4. Formation

**Sans runbook** : Nouvelles recrues d√©pendantes des seniors

**Avec runbook** : Autonomie rapide, courbe d'apprentissage r√©duite

### 5. Am√©lioration Continue

**Sans runbook** : Connaissances dans les t√™tes, difficiles √† am√©liorer

**Avec runbook** : Documentation vivante qui s'am√©liore √† chaque incident

### 6. R√©duction du Bus Factor

**Bus Factor** : Si une personne cl√© se fait renverser par un bus, peut-on continuer ?

**Sans runbook** : Bus factor = 1 (seul Bob sait comment r√©parer)

**Avec runbook** : Bus factor = ‚àû (n'importe qui peut suivre le runbook)

## Anatomie d'un Runbook

Un bon runbook contient ces √©l√©ments essentiels :

### 1. En-t√™te Identifiant

```markdown
# Runbook : [Nom de l'Alerte]

**Propri√©taire** : [√âquipe responsable]
**Derni√®re mise √† jour** : [Date]
**Version** : [Num√©ro de version]
**Contacts** : [Slack, Email, T√©l√©phone]
```

### 2. Description Rapide

**Quoi** : En une phrase, que signifie cette alerte ?

```markdown
## Description Rapide

Cette alerte se d√©clenche quand un pod utilise plus de 85%
de sa limite m√©moire pendant plus de 10 minutes.
```

### 3. Gravit√© et Urgence

```markdown
## Gravit√©

- **S√©v√©rit√©** : Warning
- **Impact** : Performance d√©grad√©e, risque de crash
- **Urgence** : Mod√©r√©e - Action n√©cessaire dans l'heure
- **R√©veil nocturne** : Non (sauf si devient Critical)
```

### 4. Impact Utilisateur

```markdown
## Impact Utilisateur

**Impact actuel** :
- Possibles ralentissements de l'API
- Latence augment√©e sur certaines requ√™tes

**Impact si non r√©solu** :
- Crash du pod (OOMKill)
- Indisponibilit√© temporaire du service
- Requ√™tes en √©chec pour les utilisateurs
```

### 5. Sympt√¥mes Associ√©s

```markdown
## Sympt√¥mes Associ√©s

Vous pourriez aussi observer :
- Latence API augment√©e
- Logs avec warnings "Memory pressure"
- M√©triques GC (Garbage Collection) √©lev√©es
- Messages "container memory limit exceeded"
```

### 6. Triage Initial

**Premi√®re √©valuation rapide (30 secondes)** :

```markdown
## Triage Initial (30 secondes)

### V√©rification Rapide

1. **Quelle est l'utilisation actuelle ?**
   ```bash
   kubectl top pod [POD_NAME] -n [NAMESPACE]
   ```
   - < 90% ‚Üí Surveillance
   - 90-95% ‚Üí Action n√©cessaire
   - > 95% ‚Üí Action urgente

2. **Combien de pods sont affect√©s ?**
   ```bash
   kubectl top pods -n [NAMESPACE] | grep -v "0%"
   ```
   - 1 pod ‚Üí Probl√®me isol√©
   - Plusieurs pods ‚Üí Probl√®me syst√©mique

3. **Y a-t-il un pic de trafic ?**
   - V√©rifier dashboard Grafana
   - Si oui ‚Üí Charge l√©gitime
   - Si non ‚Üí Possible fuite m√©moire
```

### 7. Diagnostic Approfondi

**Investigation d√©taill√©e si n√©cessaire** :

```markdown
## Diagnostic D√©taill√©

### √âtape 1 : Examiner l'Historique

Ouvrir Grafana :
[Dashboard Pod Memory](https://grafana.example.com/d/pods?var-pod={{pod}})

Questions √† se poser :
- La m√©moire augmente-t-elle lin√©airement ? (fuite probable)
- Y a-t-il des pics r√©guliers ? (charge normale)
- Augmentation r√©cente ? (depuis un d√©ploiement ?)

### √âtape 2 : V√©rifier les Logs

```bash
# Logs r√©cents
kubectl logs [POD_NAME] -n [NAMESPACE] --tail=100

# Rechercher des erreurs m√©moire
kubectl logs [POD_NAME] -n [NAMESPACE] | grep -i "memory\|oom\|heap"

# Logs de tous les containers si plusieurs
kubectl logs [POD_NAME] -n [NAMESPACE] --all-containers=true
```

Indices √† rechercher :
- "Out of memory" / "OOM"
- "Memory leak"
- "Heap exhausted"
- Stacktraces r√©p√©titives

### √âtape 3 : V√©rifier les √âv√©nements Kubernetes

```bash
kubectl get events -n [NAMESPACE] --sort-by='.lastTimestamp' | grep [POD_NAME]
```

√âv√©nements importants :
- "OOMKilled" : Pod tu√© par manque de m√©moire
- "FailedScheduling" : Pas assez de m√©moire sur les n≈ìuds
- "BackOff" : Red√©marrages r√©p√©t√©s

### √âtape 4 : Comparer avec d'Autres Pods

```bash
# Tous les pods du m√™me deployment
kubectl top pods -n [NAMESPACE] -l app=[APP_LABEL]
```

Question : Ce pod est-il une anomalie ou tous les pods sont affect√©s ?
```

### 8. Solutions par Sc√©nario

```markdown
## Solutions

### Sc√©nario A : Charge L√©gitime √âlev√©e

**Sympt√¥mes** :
- Pic de trafic visible dans Grafana
- Tous les pods affect√©s √©galement
- Utilisation augmente puis se stabilise

**Action** :
1. Scaler horizontalement (ajouter des pods) :
   ```bash
   kubectl scale deployment [DEPLOYMENT] --replicas=[N+2] -n [NAMESPACE]
   ```

2. V√©rifier que le scaling a fonctionn√© :
   ```bash
   kubectl get pods -n [NAMESPACE] -l app=[APP_LABEL]
   ```

3. Surveiller pendant 10 minutes
   - Si m√©moire diminue ‚Üí OK
   - Si m√©moire continue d'augmenter ‚Üí Sc√©nario B

**Pr√©vention** :
- Configurer Horizontal Pod Autoscaler (HPA)
- Revoir les limites de ressources si trop basses

---

### Sc√©nario B : Fuite M√©moire Suspect√©e

**Sympt√¥mes** :
- M√©moire augmente lin√©airement
- Pas de corr√©lation avec le trafic
- Un seul pod ou quelques pods affect√©s

**Action Imm√©diate** :
1. Red√©marrer le pod affect√© :
   ```bash
   kubectl delete pod [POD_NAME] -n [NAMESPACE]
   ```
   Note : Le deployment va automatiquement recr√©er le pod

2. V√©rifier que le nouveau pod d√©marre correctement :
   ```bash
   kubectl get pods -n [NAMESPACE] -w
   ```

3. Surveiller l'utilisation m√©moire du nouveau pod

**Action √† Court Terme** :
1. Cr√©er un ticket pour l'√©quipe de d√©veloppement :
   - Titre : "Fuite m√©moire suspect√©e - [POD/SERVICE]"
   - Inclure : Graphiques Grafana, logs, √©v√©nements
   - Priorit√© : Selon la fr√©quence de red√©marrage n√©cessaire

2. Si red√©marrages fr√©quents (> 1/jour) :
   - Augmenter temporairement la limite m√©moire
   - Cr√©er un CronJob de red√©marrage automatique (solution temporaire)

**Investigation D√©veloppeur** :
- Profiler l'application (heap dump)
- Revoir le code pour fuites √©videntes
- V√©rifier les caches non limit√©s
- V√©rifier les connexions non ferm√©es

---

### Sc√©nario C : Limite Trop Basse

**Sympt√¥mes** :
- Tous les pods du deployment atteignent la limite
- Utilisation stable proche de la limite
- Application fonctionne normalement sinon

**Action** :
1. V√©rifier l'utilisation "normale" sur 7 jours

2. Augmenter la limite m√©moire de 20-30% :
   ```bash
   kubectl edit deployment [DEPLOYMENT] -n [NAMESPACE]
   ```

   Modifier :
   ```yaml
   resources:
     limits:
       memory: "1Gi"  # √âtait 800Mi
     requests:
       memory: "800Mi"  # √âtait 600Mi
   ```

3. Sauvegarder et attendre le rolling update

4. Ajuster le seuil d'alerte dans Prometheus :
   - Si limite √©tait trop basse, l'alerte se d√©clenchera toujours
   - Recalculer : 85% de la nouvelle limite

**Pr√©vention** :
- Revoir les limites tous les trimestres
- Baser les limites sur des observations r√©elles
```

### 9. Commandes Utiles

```markdown
## Commandes de R√©f√©rence Rapide

### Informations Pod
```bash
# Utilisation CPU/M√©moire en temps r√©el
kubectl top pod [POD_NAME] -n [NAMESPACE]

# Description compl√®te du pod
kubectl describe pod [POD_NAME] -n [NAMESPACE]

# Manifeste YAML du pod
kubectl get pod [POD_NAME] -n [NAMESPACE] -o yaml

# Logs
kubectl logs [POD_NAME] -n [NAMESPACE] --tail=100 -f
```

### Actions
```bash
# Red√©marrer un pod
kubectl delete pod [POD_NAME] -n [NAMESPACE]

# Scaler un deployment
kubectl scale deployment [DEPLOYMENT] --replicas=5 -n [NAMESPACE]

# √âditer un deployment
kubectl edit deployment [DEPLOYMENT] -n [NAMESPACE]

# Rollback si probl√®me apr√®s changement
kubectl rollout undo deployment [DEPLOYMENT] -n [NAMESPACE]
```

### Surveillance
```bash
# Surveiller les √©v√©nements en temps r√©el
kubectl get events -n [NAMESPACE] -w

# Surveiller les pods en temps r√©el
kubectl get pods -n [NAMESPACE] -w

# Voir l'historique de d√©ploiement
kubectl rollout history deployment [DEPLOYMENT] -n [NAMESPACE]
```
```

### 10. Escalade

```markdown
## Quand Escalader ?

### Escalade Imm√©diate (L2/L3)

Si :
- [ ] Solution standard ne fonctionne pas apr√®s 30 minutes
- [ ] Probl√®me affecte > 50% des utilisateurs
- [ ] Service compl√®tement down
- [ ] Impact business critique

**Contacter** :
- On-call Senior : +33 6 XX XX XX XX
- Slack : @oncall-senior dans #incidents
- Backup : manager-tech@example.com

### Escalade Planifi√©e (Ticket)

Si :
- [ ] Fuite m√©moire confirm√©e (n√©cessite code fix)
- [ ] Probl√®me r√©current (> 3 fois / semaine)
- [ ] Architecture √† revoir

**Cr√©er un ticket** :
- JIRA : Projet INFRA
- Priorit√© : selon l'impact
- Assigner : √©quipe propri√©taire
```

### 11. Post-R√©solution

```markdown
## Apr√®s R√©solution

### 1. V√©rification (15 minutes apr√®s)

- [ ] Service fonctionne normalement
- [ ] M√©triques revenue √† la normale
- [ ] Pas d'alertes suppl√©mentaires
- [ ] Utilisateurs non impact√©s

### 2. Documentation

- [ ] Mettre √† jour le ticket avec la r√©solution
- [ ] Noter le temps de r√©solution
- [ ] Noter ce qui a fonctionn√© / pas fonctionn√©

### 3. Communication

Notifier dans #incidents :
```
‚úÖ R√©solu : HighPodMemoryUsage sur payment-service
Cause : Fuite m√©moire suite au d√©ploiement v1.2.3
Action : Rollback vers v1.2.2
Dur√©e : 25 minutes
Impact : Aucun (d√©tect√© avant impact utilisateur)
```

### 4. Suivi

Si fuite m√©moire ou probl√®me r√©current :
- [ ] Cr√©er ticket pour l'√©quipe dev
- [ ] Planifier investigation approfondie
- [ ] Revoir si changement de configuration n√©cessaire
```

### 12. Am√©liorations du Runbook

```markdown
## Notes et Am√©liorations

### Historique des Incidents

| Date | Cause | Solution | Temps | Notes |
|------|-------|----------|-------|-------|
| 2025-01-20 | Fuite m√©moire | Rollback | 25min | Ajout√© check version dans triage |
| 2025-01-15 | Charge √©lev√©e | Scale x2 | 10min | Configur√© HPA apr√®s |
| 2025-01-10 | Limite basse | +30% limite | 15min | Revu toutes les limites |

### Am√©liorations √† Faire

- [ ] Ajouter script de diagnostic automatique
- [ ] Cr√©er dashboard d√©di√© "Memory Debugging"
- [ ] Automatiser le scaling pour ce service
- [ ] Am√©liorer les logs applicatifs

### Retours d'√âquipe

*Ajoutez vos commentaires ici apr√®s avoir utilis√© ce runbook*

- 2025-01-21, Alice : "Section diagnostic tr√®s claire, r√©solu en 10min"
- 2025-01-18, Bob : "Manquait commande pour voir tous les pods, ajout√©e"
```

## Templates de Runbooks

### Template 1 : Runbook Basique (Probl√®me Simple)

```markdown
# Runbook : [NomAlerte]

**Propri√©taire** : [√âquipe]
**Contacts** : [Slack/Email]
**Mise √† jour** : [Date]

---

## üö® Description Rapide

[En une phrase : que signifie cette alerte ?]

**S√©v√©rit√©** : [Critical/Warning/Info]
**Action requise dans** : [Imm√©diat / 1h / 24h]

---

## üéØ Triage Rapide (30 secondes)

1. **V√©rifier** : [Commande de v√©rification]
2. **√âvaluer** : [Crit√®re de gravit√©]
3. **D√©cider** : Action imm√©diate ou investigation ?

---

## üîç Diagnostic

### V√©rifications Standard
```bash
[Commandes de diagnostic]
```

**√Ä rechercher** :
- [Sympt√¥me 1]
- [Sympt√¥me 2]

---

## ‚úÖ R√©solution

### Solution Standard
1. [√âtape 1]
2. [√âtape 2]
3. [√âtape 3]

### V√©rification
```bash
[Commandes de v√©rification]
```

---

## üìû Escalade

**Si √©chec apr√®s 30 min** : [Contact]

---

## üìù Post-R√©solution

- [ ] Service v√©rifi√©
- [ ] Documentation mise √† jour
- [ ] Communication faite
```

### Template 2 : Runbook Avanc√© (Probl√®me Complexe)

```markdown
# Runbook : [NomAlerte]

## M√©tadonn√©es

| Propri√©t√© | Valeur |
|-----------|--------|
| √âquipe propri√©taire | [√âquipe] |
| Contacts | [Slack], [Email], [Phone] |
| Version | 2.1 |
| Derni√®re mise √† jour | 2025-01-20 |
| Prochaine revue | 2025-04-20 |

---

## üìã Table des Mati√®res

1. [Description](#description)
2. [Impact](#impact)
3. [Triage](#triage)
4. [Diagnostic](#diagnostic)
5. [Solutions](#solutions)
6. [Escalade](#escalade)
7. [Pr√©vention](#pr√©vention)

---

## üìñ Description

### Vue d'Ensemble
[Description d√©taill√©e de l'alerte]

### Contexte Technique
[Architecture, composants impliqu√©s]

### M√©triques
- **Seuil Warning** : [Valeur]
- **Seuil Critical** : [Valeur]
- **Dur√©e** : [Temps avant d√©clenchement]

---

## üí• Impact

### Impact Utilisateur

**Si Warning** :
- [Impact si non r√©solu]

**Si Critical** :
- [Impact imm√©diat]

### Impact Business

- [Cons√©quences business]
- [SLA concern√©s]

---

## üéØ Triage Initial

### Arbre de D√©cision

```
V√©rifier [M√©trique X]
‚îú‚îÄ Si < [Seuil A] ‚Üí Sc√©nario A
‚îú‚îÄ Si [Seuil A] < X < [Seuil B] ‚Üí Sc√©nario B
‚îî‚îÄ Si > [Seuil B] ‚Üí Sc√©nario C (Escalade imm√©diate)
```

### Commandes de Triage
```bash
[Commandes rapides]
```

---

## üî¨ Diagnostic Approfondi

### Phase 1 : Collecte d'Informations
[Quelles donn√©es collecter]

### Phase 2 : Analyse
[Comment analyser les donn√©es]

### Phase 3 : Identification Cause Root
[M√©thodologie]

---

## üõ†Ô∏è Solutions

### Solution 1 : [Nom]
**Quand l'utiliser** : [Conditions]

**√âtapes** :
1. [√âtape d√©taill√©e]
2. [√âtape d√©taill√©e]

**Temps estim√©** : [Dur√©e]
**Risques** : [Risques √©ventuels]

### Solution 2 : [Nom]
[M√™me structure]

---

## üìû Escalade

### Niveau 1 (Vous)
[Essayez les solutions standard]

### Niveau 2 (Senior On-call)
**Quand** : √âchec apr√®s 30 min
**Contact** : [D√©tails]

### Niveau 3 (Management)
**Quand** : Impact critique > 1h
**Contact** : [D√©tails]

---

## üõ°Ô∏è Pr√©vention

### Court Terme
- [Action 1]
- [Action 2]

### Long Terme
- [Am√©lioration architecture]
- [Monitoring am√©lior√©]

---

## üìö Ressources

- Dashboard : [URL]
- Logs : [URL]
- Documentation : [URL]
- Code source : [URL]

---

## üìù Historique

| Date | Incident | Solution | Dur√©e | Enseignement |
|------|----------|----------|-------|--------------|
| [Date] | [Desc] | [Action] | [Temps] | [Le√ßon] |
```

### Template 3 : Runbook pour Alerte M√©tier/SLO

```markdown
# Runbook : Violation SLO [Service]

## SLO Concern√©

**SLO** : [Description du SLO]
- **Cible** : [Valeur, ex: 99.9% uptime]
- **Fen√™tre** : [P√©riode, ex: 30 jours glissants]
- **Budget d'erreur restant** : [√Ä v√©rifier dans dashboard]

---

## Contexte Business

### Impact Client
[Qu'est-ce que √ßa signifie pour nos clients ?]

### Impact Financier
[P√©nalit√©s contractuelles ? Perte de revenus ?]

---

## Triage

### 1. V√©rifier le Budget d'Erreur

```bash
# Ouvrir le dashboard SLO
[URL Dashboard]
```

Questions :
- Combien de budget reste-t-il ?
- √Ä quelle vitesse le br√ªlons-nous ?
- Combien de temps avant √©puisement ?

### 2. Identifier la Cause

**Causes possibles** :
- [ ] Incident en cours (v√©rifier #incidents)
- [ ] D√©gradation progressive
- [ ] Pic de trafic inhabituel
- [ ] D√©ploiement r√©cent

---

## Actions par Niveau de Gravit√©

### üü¢ Budget > 20% : Surveillance

**Action** :
- Surveiller l'√©volution
- Investiguer la cause
- Pas d'action urgente

### üü° Budget 5-20% : Action N√©cessaire

**Actions** :
1. Identifier et corriger la cause root
2. Communication √† l'√©quipe
3. Planifier correction pr√©ventive

### üî¥ Budget < 5% : Urgence

**Actions imm√©diates** :
1. Escalade au management
2. All-hands pour r√©solution
3. Communication clients si n√©cessaire
4. Gel des d√©ploiements

---

## Restauration du SLO

[Comment r√©cup√©rer du budget d'erreur]

---

## Post-Mortem

Si violation du SLO :
- [ ] Post-mortem obligatoire
- [ ] Communication clients
- [ ] Plan d'action correctif
- [ ] Revue des SLO si n√©cessaire
```

## Organisation des Runbooks

### Structure de R√©pertoire

```
/runbooks/
‚îú‚îÄ‚îÄ README.md                    # Index des runbooks
‚îú‚îÄ‚îÄ _templates/                  # Templates r√©utilisables
‚îÇ   ‚îú‚îÄ‚îÄ basic.md
‚îÇ   ‚îú‚îÄ‚îÄ advanced.md
‚îÇ   ‚îî‚îÄ‚îÄ slo.md
‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ high-cpu.md
‚îÇ   ‚îú‚îÄ‚îÄ high-memory.md
‚îÇ   ‚îú‚îÄ‚îÄ disk-full.md
‚îÇ   ‚îú‚îÄ‚îÄ node-down.md
‚îÇ   ‚îî‚îÄ‚îÄ network-latency.md
‚îú‚îÄ‚îÄ applications/
‚îÇ   ‚îú‚îÄ‚îÄ api-latency.md
‚îÇ   ‚îú‚îÄ‚îÄ high-error-rate.md
‚îÇ   ‚îú‚îÄ‚îÄ database-connection.md
‚îÇ   ‚îî‚îÄ‚îÄ cache-failure.md
‚îú‚îÄ‚îÄ security/
‚îÇ   ‚îú‚îÄ‚îÄ unauthorized-access.md
‚îÇ   ‚îú‚îÄ‚îÄ certificate-expiring.md
‚îÇ   ‚îî‚îÄ‚îÄ suspicious-activity.md
‚îî‚îÄ‚îÄ business/
    ‚îú‚îÄ‚îÄ slo-violation-api.md
    ‚îú‚îÄ‚îÄ payment-failure-rate.md
    ‚îî‚îÄ‚îÄ user-signup-drop.md
```

### README.md Principal

```markdown
# Runbooks Index

## Par S√©v√©rit√©

### üî¥ Critical
- [NodeDown](infrastructure/node-down.md) - N≈ìud Kubernetes inaccessible
- [DatabaseDown](applications/database-down.md) - Base de donn√©es indisponible
- [SLOViolationCritical](business/slo-violation-api.md) - SLO menac√©

### üü° Warning
- [HighCPU](infrastructure/high-cpu.md) - Utilisation CPU √©lev√©e
- [HighMemory](infrastructure/high-memory.md) - Utilisation m√©moire √©lev√©e
- [APILatency](applications/api-latency.md) - Latence API augment√©e

### üü¢ Info
- [DiskSpaceWarning](infrastructure/disk-full.md) - Espace disque faible
- [CertificateExpiring](security/certificate-expiring.md) - Certificat expire bient√¥t

## Par Composant

### Infrastructure
- [Tous les runbooks infrastructure](infrastructure/)

### Applications
- [Tous les runbooks applications](applications/)

### S√©curit√©
- [Tous les runbooks s√©curit√©](security/)

## Runbooks R√©cemment Mis √† Jour

- 2025-01-20 : [HighMemory](infrastructure/high-memory.md) - Ajout sc√©nario fuite m√©moire
- 2025-01-15 : [APILatency](applications/api-latency.md) - Ajout diagnostic base de donn√©es
- 2025-01-10 : [NodeDown](infrastructure/node-down.md) - Proc√©dure escalade mise √† jour

## Guide de Contribution

[Comment cr√©er ou modifier un runbook](CONTRIBUTING.md)
```

## Outils pour Runbooks

### 1. Markdown + Git

**Avantages** :
- Simple, l√©ger, universel
- Versioning natif avec Git
- Diff facile √† visualiser
- Fonctionne partout

**Structure** :
```bash
git clone git@github.com:company/runbooks.git
cd runbooks
vim infrastructure/new-runbook.md
git add infrastructure/new-runbook.md
git commit -m "Add runbook for XYZ"
git push
```

### 2. Wiki Interne (Confluence, Notion, etc.)

**Avantages** :
- Interface graphique friendly
- Collaboration en temps r√©el
- Recherche puissante
- Commentaires et discussions

**Organisation** :
```
Space: SRE Runbooks
‚îú‚îÄ Page: Index
‚îú‚îÄ Page: Infrastructure
‚îÇ   ‚îú‚îÄ Page: High CPU
‚îÇ   ‚îú‚îÄ Page: High Memory
‚îÇ   ‚îî‚îÄ ...
‚îú‚îÄ Page: Applications
‚îî‚îÄ Page: Security
```

### 3. Solution D√©di√©e (PagerDuty Runbook Automation, etc.)

**Avantages** :
- Int√©gration avec syst√®me d'alerting
- Automatisation possible
- Analytics et metrics

### 4. Approche Hybride (Recommand√©)

**Combine le meilleur des deux** :

1. **Source de v√©rit√©** : Git + Markdown
   - Versioning
   - Review process
   - CI/CD

2. **Consultation** : Wiki ou plateforme web
   - Interface friendly
   - Recherche
   - Liens depuis les alertes

3. **Pipeline** :
```
Git (runbooks/*.md)
    ‚Üì
CI/CD (GitHub Actions)
    ‚Üì
Wiki (pages g√©n√©r√©es automatiquement)
```

## Maintenir les Runbooks √† Jour

### 1. Processus de Revue

**Revue Apr√®s Chaque Incident** :

```markdown
## Post-Incident Checklist

- [ ] Le runbook a-t-il √©t√© utile ?
- [ ] Manquait-il des informations ?
- [ ] Les commandes fonctionnent-elles ?
- [ ] La dur√©e estim√©e est-elle correcte ?
- [ ] Nouvelles solutions d√©couvertes ?

**Actions** :
- [ ] Mettre √† jour le runbook
- [ ] Cr√©er une PR avec les changements
- [ ] Ajouter l'incident √† l'historique
```

**Revue Trimestrielle** :

```markdown
## Runbook Quarterly Review

Pour chaque runbook :

- [ ] V√©rifi√© par 2 personnes diff√©rentes
- [ ] Commandes test√©es en staging
- [ ] Liens v√©rifi√©s (Grafana, etc.)
- [ ] Contacts √† jour
- [ ] Historique r√©cent analys√©
- [ ] Am√©liorations identifi√©es

**R√©sultat** : ‚úÖ √Ä jour / üîÑ N√©cessite mise √† jour / ‚ùå Obsol√®te
```

### 2. Cycle de Vie

```
Cr√©ation
   ‚Üì
Validation (test en staging)
   ‚Üì
D√©ploiement (merge to main)
   ‚Üì
Utilisation active
   ‚Üì
Am√©lioration continue (apr√®s incidents)
   ‚Üì
Revue trimestrielle
   ‚Üì
Mise √† jour / Archive / Suppression
```

### 3. M√©triques de Qualit√©

**KPIs pour les Runbooks** :

```yaml
Runbook Quality Metrics:
  - Utilisation: "Combien de fois consult√© ?"
  - Efficacit√©: "Temps de r√©solution avec vs sans"
  - Satisfaction: "Note de 1 √† 5 par les utilisateurs"
  - Fra√Æcheur: "Derni√®re mise √† jour < 3 mois"
  - Compl√©tude: "Toutes les sections remplies"
```

**Dashboard** :
```
üìä Runbook Health Dashboard

Total: 45 runbooks
‚úÖ √Ä jour (< 3 mois): 38 (84%)
üîÑ √Ä revoir (3-6 mois): 5 (11%)
‚ùå Obsol√®tes (> 6 mois): 2 (5%)

üìà Utilisation Last 30 Days
1. high-memory.md - 24 consultations
2. api-latency.md - 18 consultations
3. node-down.md - 12 consultations

‚≠ê Top Rated
1. high-memory.md - 4.8/5
2. database-down.md - 4.7/5
3. disk-full.md - 4.5/5
```

## Bonnes Pratiques

### 1. √âcrire pour un D√©butant √† 3h du Matin

**Principe** : Si un junior d'astreinte, r√©veill√© √† 3h, peut suivre le runbook, alors il est bon.

**Implique** :
- Pas d'√©tapes implicites
- Toutes les commandes compl√®tes (avec namespaces, etc.)
- Pas de jargon sans explication
- Ordre logique, pas de sauts

### 2. Une Action = Une Commande

**‚úó Mauvais** :
```
V√©rifier l'utilisation m√©moire des pods
```

**‚úì Bon** :
```
V√©rifier l'utilisation m√©moire des pods :
```bash
kubectl top pods -n production | sort -k3 -rn | head -10
```
```

### 3. Inclure les Sorties Attendues

**‚úì Bon** :
```markdown
V√©rifier que le pod est Running :
```bash
kubectl get pod my-pod -n production
```

Sortie attendue :
```
NAME     READY   STATUS    RESTARTS   AGE
my-pod   1/1     Running   0          2m
```

Si diff√©rent, voir [Section Troubleshooting](#troubleshooting)
```

### 4. Gestion des Erreurs

**Anticiper les probl√®mes** :

```markdown
## Commande : Red√©marrer le Pod

```bash
kubectl delete pod my-pod -n production
```

**Erreurs possibles** :

### Erreur : "pod not found"
**Cause** : Le pod a d√©j√† √©t√© supprim√© ou n'existe pas
**Action** : V√©rifier que le deployment existe et cr√©era un nouveau pod

### Erreur : "permission denied"
**Cause** : Pas les droits suffisants
**Action** : Contacter l'admin ou utiliser le compte service appropri√©

### Erreur : "pod is terminating"
**Cause** : Le pod est en cours de suppression
**Action** : Attendre 30s et rev√©rifier
```

### 5. Chemins Conditionnels Clairs

**Utiliser des arbres de d√©cision** :

```markdown
## Diagnostic

1. V√©rifier l'utilisation m√©moire :
   ```bash
   kubectl top pod my-pod
   ```

   **Si < 85%** :
   ‚Üí Fausse alerte, surveiller
   ‚Üí Aller √† [Section Surveillance](#surveillance)

   **Si 85-95%** :
   ‚Üí Action n√©cessaire
   ‚Üí Aller √† [Solution Standard](#solution-standard)

   **Si > 95%** :
   ‚Üí URGENT
   ‚Üí Aller √† [Solution Urgente](#solution-urgente)
```

### 6. Liens et R√©f√©rences

**Lier les ressources pertinentes** :

```markdown
## Ressources

- üìä [Dashboard Grafana](https://grafana.example.com/d/xyz)
- üìñ [Documentation Architecture](https://wiki.example.com/arch/service-x)
- üí¨ [Canal Slack](https://slack.com/app_redirect?channel=team-backend)
- üé´ [Board JIRA](https://jira.example.com/browse/INFRA)
- üë§ [On-Call Schedule](https://pagerduty.com/schedules/xyz)
```

### 7. Contexte Visual

**Inclure des captures d'√©cran ou diagrammes quand utile** :

```markdown
## Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   API GW     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Database   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Cache      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Point de d√©faillance** : Si Database down, API GW timeout
```

### 8. Timing R√©aliste

**Indiquer des dur√©es r√©alistes** :

```markdown
## Temps Estim√©s

- **Triage initial** : 30 secondes
- **Diagnostic complet** : 5-10 minutes
- **Solution standard** : 5 minutes
- **V√©rification** : 5 minutes
- **Documentation** : 5 minutes

**Total** : 20-30 minutes
```

### 9. Feedback Loop

**Encourager les retours** :

```markdown
---

## üí¨ Votre Feedback

Ce runbook vous a-t-il √©t√© utile ?

üëç Oui - Excellent
üëå Oui - Mais peut √™tre am√©lior√©
üëé Non - Difficile √† suivre

**Commentaires ou suggestions** :
[Cr√©er une issue GitHub](https://github.com/company/runbooks/issues/new)
ou Slack: #runbooks-feedback
```

### 10. Versioning Clair

```markdown
---

## üìå Historique des Versions

### v2.1 (2025-01-20)
- Ajout√© sc√©nario C (fuite m√©moire)
- Mis √† jour commandes kubectl
- Ajout√© dashboard Grafana

### v2.0 (2024-12-15)
- Refonte compl√®te du runbook
- Ajout√© arbre de d√©cision
- Nouvelles solutions

### v1.0 (2024-10-01)
- Version initiale
```

## Automatisation des Runbooks

### 1. Scripts Compagnons

Cr√©er des scripts pour automatiser les parties r√©p√©titives :

```bash
#!/bin/bash
# scripts/diagnose-high-memory.sh

POD_NAME=$1
NAMESPACE=${2:-production}

echo "üîç Diagnostic High Memory pour $POD_NAME"
echo "==========================================="

echo -e "\nüìä Utilisation actuelle:"
kubectl top pod $POD_NAME -n $NAMESPACE

echo -e "\nüìù Logs r√©cents (erreurs m√©moire):"
kubectl logs $POD_NAME -n $NAMESPACE --tail=50 | grep -i "memory\|oom"

echo -e "\n‚ö†Ô∏è  √âv√©nements r√©cents:"
kubectl get events -n $NAMESPACE --field-selector involvedObject.name=$POD_NAME

echo -e "\nüìà Dashboard Grafana:"
echo "https://grafana.example.com/d/pods?var-pod=$POD_NAME"

echo -e "\n‚úÖ Diagnostic complet"
```

**Utilisation dans le runbook** :
```markdown
## Diagnostic Automatis√©

Ex√©cuter le script de diagnostic :
```bash
./scripts/diagnose-high-memory.sh [POD_NAME] [NAMESPACE]
```

Ce script collecte automatiquement toutes les informations n√©cessaires.
```

### 2. Runbook Automation Platforms

**Solutions** :
- PagerDuty Runbook Automation
- Rundeck
- Ansible Playbooks
- Custom scripts + ChatOps (Slack bots)

**Exemple avec Slack Bot** :
```
Vous: /runbook high-memory pod=api-123 namespace=prod
Bot: ü§ñ Ex√©cution du diagnostic...
     ‚úÖ Utilisation: 92%
     ‚úÖ Logs analys√©s: Fuite m√©moire d√©tect√©e
     ‚úÖ Solution sugg√©r√©e: Red√©marrage du pod

     Souhaitez-vous que je red√©marre le pod ? (oui/non)
Vous: oui
Bot: ‚úÖ Pod red√©marr√©. Nouveau pod: api-456
     üìä Dashboard: [lien]
```

## Conclusion

Les runbooks sont bien plus que de simples documents : ce sont des **multiplicateurs de force** pour votre √©quipe. Ils transforment le chaos des incidents en processus ma√Ætris√©s, r√©duisent le stress, acc√©l√®rent les r√©solutions et permettent l'am√©lioration continue.

**Un bon runbook** :
- Est √©crit pour √™tre compris √† 3h du matin
- Contient des commandes compl√®tes et test√©es
- Anticipe les erreurs et propose des solutions
- Est maintenu √† jour apr√®s chaque incident
- S'am√©liore continuellement

**Investir dans les runbooks**, c'est investir dans :
- La qualit√© de vie de votre √©quipe
- La fiabilit√© de vos services
- La satisfaction de vos utilisateurs
- La r√©silience de votre organisation

Commencez petit : cr√©ez des runbooks pour vos 3-5 alertes les plus fr√©quentes. Am√©liorez-les apr√®s chaque utilisation. Partagez-les avec l'√©quipe. Et progressivement, construisez une biblioth√®que de connaissances qui fera de votre √©quipe une force op√©rationnelle d'√©lite.

## Points Cl√©s √† Retenir

‚úì Un runbook = un guide pas √† pas pour r√©pondre √† une alerte

‚úì √âcrivez pour un d√©butant r√©veill√© √† 3h du matin

‚úì Incluez toutes les commandes compl√®tes et test√©es

‚úì Anticipez les erreurs et les chemins conditionnels

‚úì Mettez √† jour apr√®s CHAQUE incident

‚úì Organisez logiquement (triage ‚Üí diagnostic ‚Üí solution)

‚úì Incluez des timings r√©alistes

‚úì Liez aux ressources (dashboards, docs, contacts)

‚úì Versionnez et maintenez √† jour (revue trimestrielle)

‚úì Collectez le feedback et am√©liorez continuellement

---

**Fin du chapitre 14 : Alerting et Notifications**

Avec ce chapitre complet, vous disposez maintenant de tous les outils et connaissances pour cr√©er un syst√®me d'alerting robuste, bien document√© et efficace. Bonne chance dans la construction de votre infrastructure de monitoring ! üìöüöÄ

‚è≠Ô∏è [Observabilit√© Avanc√©e](/15-observabilite-avancee/README.md)
